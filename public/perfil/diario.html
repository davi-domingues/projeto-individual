<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Perfil - Ler&Saber</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">


</head>

<body class="perfil" onload="listarLivros()">
    
    <header>

    </header>

    <main>
        <section class="section flex">
            <div class="navbar flex">
                <div class="profile flex">
                    <div>
                        <span>foto-perfil</span>
                    </div>
                    <div>
                        <h3>Nome</h3>
                        <span>email@email.com</span>
                        <span>user_name</span>
                    </div>
                    <div>
                        <span>config-icon</span>
                    </div>
                </div>
                <div class="toolsList flex">
                    <div id="homeLink">
                        <span>home-icon</span>
                        <h3>Home Page</h3>
                    </div>                    
                    <div id="diarioLink">
                        <span>livro-icon</span>
                        <h3>Diário de Leitura</h3>
                    </div>
                    <div id="dashboardLink">
                        <span>Dashboard-icon</span>
                        <h3>Dashboard</h3>
                    </div>
                    <div id="calculadoraLink">
                        <span>Calculadora-icon</span>
                        <h3>Calculadora</h3>
                    </div>
                    <div id="relogioLink">
                        <span>Relógio-icon</span>
                        <h3>Sessão de Concentração</h3>
                    </div>
                </div>
                <div class="options flex">
                    <div id="configLink">
                        <span>config-icon</span>
                        <h3>Configuração</h3>
                    </div>
                    <div id="sairLink">
                        <span>sair-icon</span>
                        <h3>Sair</h3>
                    </div>

                </div>
            </div>
            <div class="home flex">
                <h1>Diário de Leitura</h1>
                <div id="buttons_inicial" style="display: block;">
                    <button onclick="paginaCadastrarLivro()">Cadastrar Novo Livro</button>
                    <button onclick="paginaRegistrarLeitura()">Registrar uma leitura</button>
                </div>
                <div id="pagina_conteudo" style="display: none;">
                    <div id="button_voltar" style="display: none;">
                        <button onclick="voltarPagina()">Voltar</button>
                    </div>
                    <div class="" id="pagina_cadastroLivro" style="display: none;">
                        <h3>Cadaste um novo livro aqui!</h3>
                        <div>
                            <label for="ipt_nome">Nome*</label>
                            <br><br>
                            <input type="text" id="ipt_nome" required>
                            <br><br>
                            <label for="ipt_autor">Autor*</label>
                            <br><br>
                            <input type="text" id="ipt_autor" required>
                            <br><br>
                            <label for="ipt_paginas">Total de páginas*</label>
                            <br><br>
                            <input type="number" id="ipt_paginas" required>
                            <br><br>
                            <label for="ipt_editora">Editora</label>
                            <br><br>
                            <input type="text" id="ipt_editora">
                            <br><br>
                            <label for="ipt_genero">Genero</label>
                            <br><br>
                            <input type="text" id="ipt_genero">
                            <br><br>
                            <label for="ipt_ano">Ano</label>
                            <br><br>
                            <input type="text" id="ipt_ano">
                            <br><br>
                            <label for="ipt_isbn">ISBN</label>
                            <br><br>
                            <input type="text" id="ipt_isbn">
                            <br><br>
                            <label for="ipt_sinopse">Sinopse</label>
                            <br><br>
                            <textarea id="ipt_sinopse" cols="50" rows="5" style="resize: none"></textarea>
                            <br><br>
                            <button onclick="cadastrarLivro()" id="ipt_enviarLivro">Enviar</button>
                        </div>
                    </div>
                    <div id="pagina_registroLeitura" style="display: none;">
                        <h3>Registre sua leitura aqui!</h3>
                        <div>
                            <label for="ipt_livro">Livro</label>
                            <br><br>
                            <select id="ipt_livro"></select>
                            <br><br>
                            <label for="ipt_paginasLidas">Quantidade de páginas</label>
                            <br><br>
                            <input type="number" id="ipt_paginasLidas" required>
                            <br><br>
                            <label for="ipt_comentario">Comentário</label>
                            <br><br>
                            <textarea id="ipt_comentario" cols="50" rows="5" style="resize: none"></textarea>
                            <br><br>
                            <button onclick="registrarLeitura()" id="ipt_enviarLeitura">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer flex">
        <p class="flex">
            <h4>Feito com amor por Davi Domingues &hearts; SPTech &copy; 2025</h4><span class="version">v1.0.0</span>
        </p>
        <span class="ref">Imagens Copyright &copy; 2010-2025 Freepik Company S.L. Todos os direitos reservados.</span>
    </footer>

</body>

</html>

<script src="../js/redirector.js"></script>

<script>
    listaLivrosCadastrados = [];

    function cadastrarLivro() {
        const idUsuario = sessionStorage.ID_USUARIO;
        const nome = ipt_nome.value;
        const autor = ipt_autor.value;
        const paginas = ipt_paginas.value;
        const editora = ipt_editora.value;
        const genero = ipt_genero.value;
        const ano = ipt_ano.value;
        const isbn = ipt_isbn.value;
        const sinopse = ipt_sinopse.value;

        if (nome == '' || autor == '' || paginas == '') {
            alert('Preencha os campos obrigatórios antes de cadastrar o livro!')
            return false
        };

        fetch("/diario/cadastrarLivro", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idUsuarioServer: idUsuario,
                nomeServer: nome,
                autorServer: autor,
                paginasServer: paginas,
                editoraServer: editora,
                generoServer: genero,
                anoServer: ano,
                isbnServer: isbn,
                sinopseServer: sinopse
            }),
        })
        .then(function (resposta) {
            console.log("resposta: ", resposta);
            console.log(resposta.body);

            if (resposta.ok) {
                alert('Cadastrado com sucesso!')
            } else {
                throw "Houve um erro ao tentar realizar o cadastro!";
            };
        })
        .catch(function (resposta) {
            console.log(resposta)
            console.log(resposta.status)
            if (resposta.status === 500) {alert('Site deconectado do servidor')};
            console.log(`#ERRO ${resposta}`)
        });
    };
    
    function registrarLeitura() {
        const idUsuario = sessionStorage.ID_USUARIO;
        const idLivro = ipt_livro.value;
        const paginasLidas = ipt_paginasLidas.value;
        const comentario = ipt_comentario.value;

        fetch("/diario/registrarLeitura", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idUsuarioServer: idUsuario,
                idLivroServer: idLivro,
                paginasLidasServer: paginasLidas,
                comentarioServer: comentario
            }),
        })
        .then(function (resposta) {
            console.log("resposta: ", resposta);
            console.log(resposta.body);

            if (resposta.ok) {
                alert('Cadastrado com sucesso!')
            } else {
                throw "Houve um erro ao tentar realizar o cadastro!";
            };
        })
        .catch(function (resposta) {
            console.log(resposta)
            if (resposta.status === 500) {alert('Site deconectado do servidor')};
            console.log(`#ERRO ${resposta}`)
        });
    };

    function listarLivros() {
        fetch(`/diario/listarLivros/${sessionStorage.ID_USUARIO}`, { cache: 'no-store' })
            .then((resposta) => {
                resposta.json().then((livros) => {
                    livros.forEach((livro) => {
                        listaLivrosCadastrados.push(livro);
                        const option = ipt_livro.appendChild(document.createElement("option"));
                        option.textContent = `${livro.at_nome} - ${livro.at_autor} (${livro.at_paginas_total} páginas)`;
                        option.value = livro.at_idLivro;
                    })
                })
            })
            .catch((resposta) => {
                console,log(`#ERRO: ${resposta}`)
            })
        ;
    }
</script>

<script>
    function paginaCadastrarLivro() {
        habilitar(pagina_conteudo);
        habilitar(button_voltar);
        habilitar(pagina_cadastroLivro);
        desabilitar(buttons_inicial);
        
    };
    function paginaRegistrarLeitura() {
        habilitar(pagina_conteudo);
        habilitar(button_voltar);
        habilitar(pagina_registroLeitura);
        desabilitar(buttons_inicial);
    };
    function voltarPagina() {
        desabilitar(pagina_conteudo);
        desabilitar(button_voltar);
        desabilitar(pagina_registroLeitura);
        desabilitar(pagina_cadastroLivro);
        habilitar(buttons_inicial);
    };
    function habilitar(idElement) {
        idElement.style.display = 'block'
    };
    function desabilitar(idElement) {
        idElement.style.display = 'none'
    };
</script>